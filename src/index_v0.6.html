<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Prototype Storyboards</title>
        <style>
            body{
                margin: 0;
                overflow: hidden;
                font-family: "Lato", sans-serif;
            }

            .navbar {
                overflow: hidden;
                background-color: #333; 
            }

            .navbar a {
                float: left;
                font-size: 16px;
                color: white;
                text-align: center;
                padding: 14px 16px;
                text-decoration: none;
            }

            .subnav {
                float: left;
                overflow: hidden;
            }

            .subnav .subnavbtn {
                font-size: 16px;  
                border: none;
                outline: none;
                color: white;
                padding: 14px 16px;
                background-color: inherit;
                font-family: inherit;
                margin: 0;
            }

            .navbar a:hover, .subnav:hover .subnavbtn {
                background-color: grey;
            }

            .subnav-content {
                display: none;
                position: absolute;
                left: 0;
                background-color:grey;
                width: 100%;
                z-index: 1;
            }

            .subnav-content a {
                float: left;
                color: white;
                text-decoration: none;
            }

            .subnav-content a:hover {
                background-color: #eee;
                color: black;
            }

            .subnav:hover .subnav-content {
                display: block;
            }

        </style>
    </head>

    <body>
          
        <div class="navbar">
            <div style="color:white; padding:0 16px">
                <h3>Storyboard</h3>
            </div>
        
        <div class="subnav">
            <button class="subnavbtn">Characters <i class="fa fa-caret-down"></i></button>
            <div class="subnav-content">
                <a id="man" href="#">Man</a>
                <a id="woman" href="#">Woman</a>
            </div>
        </div> 
        <div class="subnav">
            <button class="subnavbtn">Furniture<i class="fa fa-caret-down"></i></button>
            <div class="subnav-content">
                <a id="table" href="#">Table</a>
            </div>
        </div> 
        <div class="subnav">
            <button class="subnavbtn">Vehicles <i class="fa fa-caret-down"></i></button>
            <div class="subnav-content">
                <a id="bicycle" href="#">Bicycle</a>
            </div>
        </div>
        <div class="subnav">
            <button class="subnavbtn">Buildings <i class="fa fa-caret-down"></i></button>
            <div class="subnav-content">
                <a id="factory" href="#">Factory</a>
            </div>
        </div>
        <div class="subnav">
            <button class="subnavbtn">Background <i class="fa fa-caret-down"></i></button>
            <div class="subnav-content">
                <a id="meetingroom" href="#">Meeting Room</a>
            </div>
        </div> 

        <script type="module"> //For HTML5-compliant browsers the code is treated as a JavaScript module.
            import * as THREE from '../lib/three.js-master/build/three.module.js';
            import { GLTFLoader } from '../lib/three.js-master/examples/jsm/loaders/GLTFLoader.js';
            import { OrbitControls } from '../lib/three.js-master/examples/jsm/controls/OrbitControls.js';
            import { DragControls } from '../lib/three.js-master/examples/jsm/controls/DragControls.js';
            import { TransformControls } from '../lib/three.js-master/examples/jsm/controls/TransformControls.js'

            // ----------------------------------------------------------------------------
            //  global variables 
            // ----------------------------------------------------------------------------
            let scene, camera, renderer, light, controls;
            
            let objects = [];

            let board, storyboard;

            const LEFT = 37, RIGHT = 39, UP = 38, DOWN = 40;
            let ADD;

            //let raycaster = new THREE.Raycaster();
            //let mouse = new THREE.Vector2();

            // ----------------------------------------------------------------------------
            // end of global variables
            // ----------------------------------------------------------------------------


            window.addEventListener('click', onClick, false);
            window.requestAnimationFrame(render);

            // ----------------------------------------------------------------------------
            //  Init Function - initialize the project
            // ----------------------------------------------------------------------------
            let init = function(){

                // --- create the scene --- //
                scene = new THREE.Scene();
                scene.background = new THREE.Color(0x87CEEB);
                

                // --- create and locate the camera --- //
                camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 1, 1000);
                camera.position.set(0, 5, 20);

                // --- create the light --- //
                light = new THREE.AmbientLight(0xffffff);
                scene.add(light);
                

                // --- create the renderer --- //
                renderer = new THREE.WebGLRenderer({antialias: true});
                renderer.setClearColor(0x000000, 1.0);
                renderer.setSize(window.innerWidth, window.innerHeight);
                renderer.shadowMap.enabled = true;
                renderer.setPixelRatio(window.devicePixelRatio);
                renderer.outputEncoding = THREE.sRGBEncoding; //configure textures referenced from .glb
                // --- to be able to locate on the browser --- //
                document.body.appendChild(renderer.domElement);
               
                // --- create the floor --- // 
                const floorGometry = new THREE.PlaneGeometry( 400, 400 );
                const floorMaterial = new THREE.MeshBasicMaterial( {color: 0x567d46} );
                const floor = new THREE.Mesh( floorGometry, floorMaterial );
                floor.rotation.x = - Math.PI / 2;
                scene.add( floor );

                // --- create the storyboard with different squares--- //
                const boardGeometry = new THREE.BoxGeometry(10, 1, 10);
                const boardMaterial = new THREE.MeshBasicMaterial( {color: 0x444444 });
                                
                storyboard = new THREE.Group();

                for (let x = 0; x < 3; x++) {
                    for (let z = 0; z < 2; z++) {
                        
                        board = new THREE.Mesh(boardGeometry, boardMaterial);
 
                        board.position.x = x * 12;
                        board.position.z = z * 12;
                        //board.position.set(x*10, 0, z*10);
                        storyboard.add(board);
                    }
                }
                scene.add(storyboard);
                // -------------------------------------- end of creating the storyboard
                               
                // --- add the Orbit Control, it rotates the camera and enforces the camera up direction--- // 
                controls = new OrbitControls(camera, renderer.domElement);
                controls.target.set(0,1.6, 0);
                controls.update();

                // --- generates a prefiltered, midmapped radiance environment MAP --- //
                let pmremGenerator = new THREE.PMREMGenerator( renderer );
			    pmremGenerator.compileEquirectangularShader();

                // --- load function for window resize --- //
                resize();

                // --- Drag function --- //
                dragControl();

                //
                document.addEventListener("keydown", onKeyDown, false);

            };
            // ----------------------------------------------------------------------------
            //  End of Init Function
            // ----------------------------------------------------------------------------


            // ----------------------------------------------------------------------------
            //  OnClick Function - adding gltf-objects by clicking on the menu
            // ----------------------------------------------------------------------------
            function onClick(){
                let addingMan = document.getElementById("man");
                addingMan.addEventListener("click", addMan, false);
                function addMan(){
                    let loader = new GLTFLoader();
                    loader.load("../src/img/man.glb", function(gltf){ 
                        let figure = gltf.scene;
                        figure.scale.set(2, 2, 2);
                        console.log(figure);
                        figure.position.set(-20,2,2);
                        scene.add(figure);
                        objects.push(figure);                                
                    },
                    function(xhr){
                        console.log((xhr.loaded / xhr.total*100)+ '% loaded');
                    }, 
                    function(error){
                        console.log('An error happened');
                    });
                }

                let addingWoman = document.getElementById("woman");
                addingWoman.addEventListener("click", addWoman, false);
                function addWoman(){
                    let loader = new GLTFLoader();        
                    loader.load("../src/img/woman.glb", function(gltf){ 
                        let figure = gltf.scene;
                        figure.scale.set(2, 2, 2);
                        console.log(figure);
                        figure.position.set(-18,2,2);
                        scene.add(figure); 
                        objects.push(figure);                               
                    },
                    function(xhr){
                        console.log((xhr.loaded / xhr.total*100)+ '% loaded');
                    }, 
                    function(error){
                        console.log('An error happened');
                    });
                }

                let addingTable = document.getElementById("table");
                addingTable.addEventListener("click", addTable, false);
                function addTable(){
                    let loader = new GLTFLoader();                   
                    loader.load("../src/img/table.glb", function(gltf){ 
                        let figure = gltf.scene;                      
                        console.log(figure);
                        figure.position.set(-15,2,2);
                        scene.add(figure); 
                        objects.push(figure);                                
                    },
                    function(xhr){
                        console.log((xhr.loaded / xhr.total*100)+ '% loaded');
                    }, 
                    function(error){
                        console.log('An error happened');
                    });
                }

                let addingBicycle = document.getElementById("bicycle");
                addingBicycle.addEventListener("click", addBicycle, false);
                function addBicycle(){
                    let loader = new GLTFLoader();                   
                    loader.load("../src/img/bicycle.glb", function(gltf){ 
                        let figure = gltf.scene;  
                        figure.scale.set(1.5, 1.5, 1.5);                    
                        console.log(figure);
                        figure.position.set(-12,2,2);
                        scene.add(figure); 
                        objects.push(figure);                                
                    },
                    function(xhr){
                        console.log((xhr.loaded / xhr.total*100)+ '% loaded');
                    }, 
                    function(error){
                        console.log('An error happened');
                    });
                }

                let addingFactory = document.getElementById("factory");
                addingFactory.addEventListener("click", addFactory, false);
                function addFactory(){
                    let loader = new GLTFLoader();                   
                    loader.load("../src/img/factory.glb", function(gltf){ 
                        let figure = gltf.scene;    
                        figure.scale.set(5, 5, 5);                  
                        console.log(figure);
                        figure.position.set(-10,2,2);
                        scene.add(figure);
                        objects.push(figure);                                
                    },
                    function(xhr){
                        console.log((xhr.loaded / xhr.total*100)+ '% loaded');
                    }, 
                    function(error){
                        console.log('An error happened');
                    });
                }

                let addingMeetingroom = document.getElementById("meetingroom");
                addingMeetingroom.addEventListener("click", addMeetingroom, false);
                function addMeetingroom(){
                    let loader = new GLTFLoader();                   
                    loader.load("../src/img/meeting_room.glb", function(gltf){ 
                        let figure = gltf.scene;   
                        figure.scale.set(3,3,3);                     
                        console.log(figure);
                        figure.position.set(-8,2,2);
                        scene.add(figure);  
                        objects.push(figure);                                
                    },
                    function(xhr){
                        console.log((xhr.loaded / xhr.total*100)+ '% loaded');
                    }, 
                    function(error){
                        console.log('An error happened');
                    });
                }

            }
            // ----------------------------------------------------------------------------
            // End of OnClick Function
            // ----------------------------------------------------------------------------



            // ----------------------------------------------------------------------------
            //  DragControl Function - drag and drop the gltf-objects around the scene
            // ----------------------------------------------------------------------------
            function dragControl(){
                let dragControls = new DragControls(objects, camera, renderer.domElement);
            
                dragControls.addEventListener('dragstart', function(event){
                    controls.enabled = false;
                    event.object.material.emissive.set( 0xaaaaaa );
                });
                dragControls.addEventListener('dragend', function(event){
                    controls.enabled = true;
                    event.object.material.emissive.set( 0x000000 );
                    //event.object.position.y = 0.2; 
                });
            }
            // ----------------------------------------------------------------------------
            //  End of DragControl Function
            // ----------------------------------------------------------------------------
           

            // ----------------------------------------------------------------------------
            //  Resize Function - reports the window size each time it is resized
            // ----------------------------------------------------------------------------
            function resize(){
                window.addEventListener('resize', onWindowResize, false);

                function onWindowResize(){
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();

                renderer.setSize(window.innerWidth, window.innerHeight);
                }
            }
            // ----------------------------------------------------------------------------
            //  End of Resize Function
            // ----------------------------------------------------------------------------

            // ----------------------------------------------------------------------------
            //  onKeyDown Function - to move around the scene with defined keys
            // ----------------------------------------------------------------------------
            function onKeyDown(e){
                if(e.keyCode == LEFT)
                    scene.position.x += 0.2;
                else if(e.keyCode == RIGHT)
                    scene.position.x -= 0.2;
                else if(e.keyCode == UP)
                    scene.position.z += 0.2;
                else if(e.keyCode == DOWN)
                    scene.position.z -= 0.2;
                else
                    return;
            }
            // ----------------------------------------------------------------------------
            //  End of onKeyDown Function
            // ----------------------------------------------------------------------------


            // ----------------------------------------------------------------------------
            //  Render Function
            // ----------------------------------------------------------------------------
            function render() {
                controls.update();
                renderer.render( scene, camera );
               requestAnimationFrame(render);
            }
            // ----------------------------------------------------------------------------
            //  End of Render Function
            // ----------------------------------------------------------------------------

//-----------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------
//-----------------------------------------------------------------------------------------

            // -------------------- calls the init function when the window is done loading
            init();
            render();

        </script>
    </body>    
</html>